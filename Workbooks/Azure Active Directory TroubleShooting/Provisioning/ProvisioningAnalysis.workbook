{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Provisioning Logs\r\n"
      },
      "name": "ProvisioningLogsTitle"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "f577790a-f514-4e4c-b121-6b24c180794c",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "Time range to filter the data on",
            "value": {
              "durationMs": 7776000000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          },
          {
            "id": "91a07371-89bf-42f5-9a7a-15eec6ac081c",
            "version": "KqlParameterItem/1.0",
            "name": "JobId",
            "type": 2,
            "description": "Identifier for your provisioning configuration, found in the progress bar under view technical information",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AADProvisioningLogs\r\n| distinct JobId",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "91a07371-89bf-42f5-9a7a-14eec6ac081c",
            "version": "KqlParameterItem/1.0",
            "name": "Status",
            "type": 2,
            "description": "Filter to determine if the provisioning event was successful, failed, or skipped",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AADProvisioningLogs\r\n| distinct ResultType",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 604800000
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "2fb64337-1e0f-48fe-abbb-36bc631f3a79",
            "version": "KqlParameterItem/1.0",
            "name": "App",
            "type": 2,
            "description": "Name of the application / service principal",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AADProvisioningLogs\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| distinct tostring(servicePrincipal.Name)",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "timeContextFromParameter": "TimeRange",
            "defaultValue": "value::all",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces",
            "value": [
              "value::all"
            ]
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Top Level Filters TimeRange, JobId, etc."
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where servicePrincipal.Name in ({App}) or '*' in ({App})\r\n| where JobId in ({JobId}) or '*' in ({JobId})\r\n| where ResultType in ({Status}) or '*' in ({Status})\r\n| extend SourceIdentity = parse_json(SourceIdentity)\r\n| where tostring(SourceIdentity.identityType) != \"FakeServicePrincipal\"\r\n| summarize Objects = dcount(tostring(SourceIdentity.Id)) by tostring(SourceIdentity.identityType)\r\n| order by Objects",
        "size": 4,
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "SourceIdentity_identityType",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "Objects",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "50",
      "name": "Object count"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend scenario = case(JobId contains \"AD2AADProvisioning\", \"Active Directory\",\r\n                       JobId contains \"AADToSuccessFactorsWriteback\", \"HR Systems\", \r\n                       JobId contains \"WDAYinAppDelta\", \"HR Systems\", \r\n                       JobId contains \"WDAYdnADDelta\", \"HR Systems\", \r\n                       JobId contains \"WDAYoutAppDelta\", \"HR Systems\", \r\n                       JobId contains \"SuccessFactorsToAADProvisioning\", \"HR Systems\", \r\n                       JobId contains \"SuccessFactorsToADProvisioning\", \"HR Systems\", \r\n                       \"Applications\")\r\n| summarize dcount(JobId) by scenario",
        "size": 4,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "scenario",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "dcount_JobId",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 2,
                "maximumSignificantDigits": 3
              }
            }
          },
          "showBorder": false,
          "size": "auto"
        }
      },
      "customWidth": "30",
      "name": "Application, HR, Tenant count"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| where ResultType in ({Status}) or '*' in ({Status})\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where servicePrincipal.Name in ({App}) or '*' in ({App})\r\n| where JobId in ({JobId}) or '*' in ({JobId})\r\n| summarize count() by bin(TimeGenerated, 1h), Action\r\n",
        "size": 0,
        "title": "Provisioning events per hour",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "timechart",
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "Action",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "count_",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "xAxis": "TimeGenerated"
        }
      },
      "name": "Operations over time"
    },
    {
      "type": 1,
      "content": {
        "json": "# Provisioning activity from my tenant out to other tenants / applications"
      },
      "name": "text - 14"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend statusInfo = parse_json(ProvisioningStatusInfo)\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where ResultType != \"Skipped\"\r\n| summarize SuccessRate = 100*countif(ResultType == \"Success\")/(countif(ResultType == \"Failure\")+countif(ResultType == \"Success\")) by tostring(servicePrincipal.Name), tostring(servicePrincipal.Id)\r\n| join kind = fullouter        \r\n    (\r\nAADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend statusInfo = parse_json(ProvisioningStatusInfo)\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where ResultType != \"Skipped\"\r\n| summarize Create = countif(ProvisioningAction == \"create\" and ResultType == \"Success\"), Update = countif(ProvisioningAction == \"update\" and ResultType == \"Success\"), Disable = countif(ProvisioningAction == \"disable\" and ResultType == \"Success\"), Delete = countif(ProvisioningAction == \"delete\" and ResultType == \"Success\"), Failures = countif(ResultType == \"Failure\")  by tostring(servicePrincipal.Id)\r\n    )\r\non $left.servicePrincipal_Id == $right.servicePrincipal_Id\r\n| join kind = fullouter         \r\n    (\r\nAuditLogs\r\n| where TimeGenerated {TimeRange}\r\n| where ActivityDisplayName == \"Quarantine\"\r\n| extend TargetResources = parse_json(TargetResources)\r\n| mvexpand TargetResources\r\n| where TargetResources.id != \"\"\r\n| summarize max(TimeGenerated) by tostring(TargetResources.id), tostring(TargetResources.displayName)\r\n| project TargetResources_id, max_TimeGenerated, TargetResources_displayName\r\n)\r\non $left.servicePrincipal_Id == $right.TargetResources_id\r\n| extend ServicePrincipalId = coalesce(['servicePrincipal_Id'], TargetResources_id)\r\n| extend Name = coalesce(TargetResources_displayName, servicePrincipal_Name)\r\n| project Name, SuccessRate, ['Create'], ['Update'], ['Disable'], ['Delete'], ['Failures'], MostRecentQuarantine = max_TimeGenerated, ServicePrincipalId\r\n| order by SuccessRate",
        "size": 0,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "SuccessRate",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue"
              }
            }
          ]
        }
      },
      "name": "Operations by job"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs \r\n| where TimeGenerated {TimeRange}\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where servicePrincipal.Name in ({App}) or '*' in ({App})\r\n| where JobId in ({JobId}) or '*' in ({JobId})\r\n| where ResultType in ({Status}) or '*' in ({Status})\r\n| summarize count () by ResultType",
        "size": 3,
        "title": "Provisioning success rate",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart",
        "chartSettings": {
          "yAxis": [
            "count_"
          ],
          "seriesLabelSettings": [
            {
              "seriesName": "Failure",
              "color": "redBright"
            },
            {
              "seriesName": "Skipped",
              "color": "yellow"
            },
            {
              "seriesName": "Success",
              "color": "green"
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "Provisioning success rate"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where servicePrincipal.Name in ({App}) or '*' in ({App})\r\n| where JobId in ({JobId}) or '*' in ({JobId})\r\n| where ResultType in ({Status}) or '*' in ({Status})\r\n| where ResultType == \"Failure\"\r\n| summarize Count=count(), LastSeen=max(TimeGenerated) by ErrorCode = ResultSignature\r\n| order by Count",
        "size": 3,
        "title": "Top provisioning errors",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Count",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "Occurrences",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue"
              }
            }
          ]
        },
        "sortBy": []
      },
      "customWidth": "50",
      "name": "Top errors"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs \r\n| where TimeGenerated {TimeRange}\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where servicePrincipal.Name in ({App}) or '*' in ({App})\r\n| where JobId in ({JobId}) or '*' in ({JobId})\r\n| where ResultType in ({Status}) or '*' in ({Status})\r\n| summarize Count = count(), CycleTime=max(TimeGenerated) by CycleId , Action\r\n| project CycleTime, Action, Count, CycleId\r\n| order by CycleTime\r\n",
        "size": 0,
        "title": "Provisioning events per cycle",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Count",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "count_",
              "formatter": 4,
              "formatOptions": {
                "palette": "blue"
              }
            }
          ],
          "sortBy": [
            {
              "itemKey": "CycleTime",
              "sortOrder": 1
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "CycleTime",
            "sortOrder": 1
          }
        ]
      },
      "customWidth": "50",
      "name": "Cycle events"
    },
    {
      "type": 1,
      "content": {
        "json": "# What are all the tenants and applications a user has been created, updated, or disabled in?"
      },
      "name": "Title for user search"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "930a9c80-334f-43a0-af56-b6e04cd338b6",
            "version": "KqlParameterItem/1.0",
            "name": "ID",
            "type": 2,
            "description": "ObjectID of the user in Azure AD",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend sourceIdentity = parse_json(SourceIdentity)\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| distinct tostring(sourceIdentity.Id)",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "50bb0a6f-7472-4edd-a794-a342e476f6bb",
            "version": "KqlParameterItem/1.0",
            "name": "UPN",
            "type": 2,
            "description": "User principal name of the user in Azure AD",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend sourceIdentity = parse_json(SourceIdentity)\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| distinct tostring(sourceIdentity.details.UserPrincipalName)",
            "value": [
              "arvinh@woodgrove.ms"
            ],
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - 4"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| where ResultType == \"Success\"\r\n| extend sourceIdentity = parse_json(SourceIdentity)\r\n| extend targetIdentity = parse_json(TargetIdentity)\r\n| extend servicePrincipal = parse_json(ServicePrincipal)\r\n| where sourceIdentity.identityType == \"User\"\r\n| where tostring(sourceIdentity.details.UserPrincipalName) == {UPN} or tostring(targetIdentity.details.UserPrincipalName) == {UPN} or tostring(sourceIdentity.Id) == {ID} or tostring(targetIdentity.Id) == {ID} \r\n| distinct tostring(sourceIdentity.Name), tostring(sourceIdentity.details.UserPrincipalName), tostring(sourceIdentity.Id), tostring(servicePrincipal.Name), TimeGenerated\r\n| project Name = sourceIdentity_Name, UserPrincipalName = sourceIdentity_details_UserPrincipalName, ID = sourceIdentity_Id, ServicePrincipalName = servicePrincipal_Name",
        "size": 1,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "User search"
    },
    {
      "type": 1,
      "content": {
        "json": "# Provisioning event explorer"
      },
      "name": "text - 14"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "df0daa14-df50-411a-a4dc-6e8d99b20559",
            "version": "KqlParameterItem/1.0",
            "name": "SourceIdentityName",
            "type": 1,
            "description": "Display name of the user in the source system",
            "timeContext": {
              "durationMs": 86400000
            },
            "value": "A"
          },
          {
            "id": "9ebd9331-1c2a-43a2-90ac-1f84a946cfc0",
            "version": "KqlParameterItem/1.0",
            "name": "SourceIdentityId",
            "type": 2,
            "description": "Id of the user in the source system (e.g. objectID)",
            "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend sourceIdentity = parse_json(SourceIdentity)\r\n| distinct tostring(sourceIdentity.Id)",
            "value": null,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "88f1b311-91cf-411a-9d70-193ce0f04f2d",
            "version": "KqlParameterItem/1.0",
            "name": "SourceIdentityType",
            "type": 2,
            "description": "Identity type (e.g. user or group)",
            "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend sourceIdentity = parse_json(SourceIdentity)\r\n| distinct tostring(sourceIdentity.identityType)",
            "value": "User",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "38e00281-0391-4603-8ee0-03f4c2243532",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "Date range to filter the data",
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": false
            },
            "value": {
              "durationMs": 2419200000
            }
          },
          {
            "id": "04f3b963-b6b5-4661-b23a-4ce80be18565",
            "version": "KqlParameterItem/1.0",
            "name": "ErrorCode",
            "type": 2,
            "description": "Error code for the provisioning event",
            "query": "AADProvisioningLogs\r\n| distinct ResultSignature",
            "value": null,
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          {
            "id": "752d0699-390b-4f64-bf3d-a2423dc03518",
            "version": "KqlParameterItem/1.0",
            "name": "CycleId",
            "type": 1,
            "description": "Identifies the cycle during which the events occurred",
            "value": ""
          },
          {
            "id": "13db71f0-e435-458f-b7cf-635159d4d0d2",
            "version": "KqlParameterItem/1.0",
            "name": "Status",
            "type": 2,
            "description": "Indicates if the provisioning events were successful, failed, or skipped",
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "AADProvisioningLogs\r\n| distinct ResultType",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "Provisioning event explorer title"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AADProvisioningLogs\r\n| where TimeGenerated {TimeRange}\r\n| extend SourceIdentity = parse_json(SourceIdentity)\r\n| extend ErrorCode = ResultSignature\r\n| where tostring(SourceIdentity.Name) contains '{SourceIdentityName:label}' or tostring(SourceIdentity.Id) contains '{SourceIdentityId:label}' or tostring(SourceIdentity.IdentityType) contains '{SourceIdentityType:label}' or ErrorCode contains '{ErrorCode:label}' or CycleId contains '{CycleId:label}' or ResultType contains '{Status:label}'\r\n| project tostring(SourceIdentity.Name), tostring(SourceIdentity.Id), Action, Status = ResultType, ErrorCode, ErrorMessage = ResultDescription, TimeGenerated, ModifiedProperties, ProvisioningSteps, ServicePrincipal, SourceSystem, StatusInfo, TargetIdentity, TargetSystem, InitiatedBy, tostring(SourceIdentity.identityType), ChangeId, CycleId, CorrelationId, Id, JobId\r\n| order by TimeGenerated",
        "size": 0,
        "showAnalytics": true,
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "sortBy": [
            {
              "itemKey": "Status",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "Status",
            "sortOrder": 2
          }
        ]
      },
      "name": "Provisioning event explorer"
    },
    {
      "type": 1,
      "content": {
        "json": "# Quarantine history"
      },
      "name": "Quarantine history title"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "AuditLogs\r\n| where TimeGenerated {TimeRange}\r\n| where ActivityDisplayName == \"Quarantine\"\r\n| parse ResultDescription with * \"Error:\" QuarantineReason \r\n| extend TargetResources = parse_json(TargetResources)\r\n| mv-expand TargetResources\r\n| where tostring(TargetResources.id) != \"\"\r\n| distinct  QuarantineReason, TimeGenerated, tostring(TargetResources.displayName), tostring(TargetResources.id), CorrelationId\r\n| project QuarantineReason, TimeGenerated, ServicePrincipalDisplayName = TargetResources_displayName, ServicePrincipalId = TargetResources_id, CorrelationId",
        "size": 0,
        "showAnalytics": true,
        "showExportToExcel": true,
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "sortBy": [
            {
              "itemKey": "TimeGenerated",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "TimeGenerated",
            "sortOrder": 2
          }
        ]
      },
      "name": "Quarantine history table"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/ab48f397-fc82-4634-aa52-62dd91b3ebaa/resourcegroups/woodgrove-rg/providers/microsoft.operationalinsights/workspaces/woodgrove-loganalyiticsworkspace"
  ],
  "fromTemplateId": "community-Workbooks/Azure Active Directory TroubleShooting/Provisioning",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}